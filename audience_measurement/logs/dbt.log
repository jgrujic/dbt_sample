

============================== 2022-02-03 22:00:35.930943 | 2cafe138-753e-495c-ac25-ae47e5f2d113 ==============================
22:00:35.930943 [info ] [MainThread]: Running with dbt=1.0.1
22:00:35.931307 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=None, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/home/jelena/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
22:00:35.931469 [debug] [MainThread]: Tracking: tracking
22:00:35.931644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f20aa04c250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f20aa04c2b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f20aa04c310>]}
22:00:35.938194 [info ] [MainThread]: Partial parse save file not found. Starting full parse.
22:00:35.938420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '2cafe138-753e-495c-ac25-ae47e5f2d113', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f20aa09aee0>]}
22:00:35.943964 [debug] [MainThread]: Parsing macros/adapters.sql
22:00:35.966884 [debug] [MainThread]: Parsing macros/catalog.sql
22:00:35.967994 [debug] [MainThread]: Parsing macros/materializations/merge.sql
22:00:35.970242 [debug] [MainThread]: Parsing macros/materializations/incremental.sql
22:00:35.975206 [debug] [MainThread]: Parsing macros/materializations/table.sql
22:00:35.976982 [debug] [MainThread]: Parsing macros/materializations/view.sql
22:00:35.977734 [debug] [MainThread]: Parsing macros/materializations/seed.sql
22:00:35.981417 [debug] [MainThread]: Parsing macros/materializations/snapshot.sql
22:00:35.981999 [debug] [MainThread]: Parsing macros/materializations/configs.sql
22:00:35.983321 [debug] [MainThread]: Parsing macros/materializations/hooks.sql
22:00:35.985601 [debug] [MainThread]: Parsing macros/materializations/tests/helpers.sql
22:00:35.986589 [debug] [MainThread]: Parsing macros/materializations/tests/where_subquery.sql
22:00:35.987594 [debug] [MainThread]: Parsing macros/materializations/tests/test.sql
22:00:35.990281 [debug] [MainThread]: Parsing macros/materializations/models/view/helpers.sql
22:00:35.991071 [debug] [MainThread]: Parsing macros/materializations/models/view/view.sql
22:00:35.994995 [debug] [MainThread]: Parsing macros/materializations/models/view/create_view_as.sql
22:00:35.996376 [debug] [MainThread]: Parsing macros/materializations/models/view/create_or_replace_view.sql
22:00:35.997980 [debug] [MainThread]: Parsing macros/materializations/models/table/table.sql
22:00:36.002259 [debug] [MainThread]: Parsing macros/materializations/models/table/create_table_as.sql
22:00:36.003876 [debug] [MainThread]: Parsing macros/materializations/models/incremental/merge.sql
22:00:36.010298 [debug] [MainThread]: Parsing macros/materializations/models/incremental/incremental.sql
22:00:36.016157 [debug] [MainThread]: Parsing macros/materializations/models/incremental/column_helpers.sql
22:00:36.018699 [debug] [MainThread]: Parsing macros/materializations/models/incremental/is_incremental.sql
22:00:36.019517 [debug] [MainThread]: Parsing macros/materializations/models/incremental/on_schema_change.sql
22:00:36.028491 [debug] [MainThread]: Parsing macros/materializations/seeds/helpers.sql
22:00:36.037549 [debug] [MainThread]: Parsing macros/materializations/seeds/seed.sql
22:00:36.041040 [debug] [MainThread]: Parsing macros/materializations/snapshots/helpers.sql
22:00:36.047318 [debug] [MainThread]: Parsing macros/materializations/snapshots/snapshot_merge.sql
22:00:36.048247 [debug] [MainThread]: Parsing macros/materializations/snapshots/strategies.sql
22:00:36.058126 [debug] [MainThread]: Parsing macros/materializations/snapshots/snapshot.sql
22:00:36.064546 [debug] [MainThread]: Parsing macros/generic_test_sql/accepted_values.sql
22:00:36.065386 [debug] [MainThread]: Parsing macros/generic_test_sql/relationships.sql
22:00:36.065919 [debug] [MainThread]: Parsing macros/generic_test_sql/not_null.sql
22:00:36.066254 [debug] [MainThread]: Parsing macros/generic_test_sql/unique.sql
22:00:36.066634 [debug] [MainThread]: Parsing macros/etc/datetime.sql
22:00:36.071226 [debug] [MainThread]: Parsing macros/etc/statement.sql
22:00:36.073840 [debug] [MainThread]: Parsing macros/adapters/freshness.sql
22:00:36.075432 [debug] [MainThread]: Parsing macros/adapters/schema.sql
22:00:36.076605 [debug] [MainThread]: Parsing macros/adapters/persist_docs.sql
22:00:36.079331 [debug] [MainThread]: Parsing macros/adapters/relation.sql
22:00:36.084736 [debug] [MainThread]: Parsing macros/adapters/indexes.sql
22:00:36.086282 [debug] [MainThread]: Parsing macros/adapters/metadata.sql
22:00:36.090475 [debug] [MainThread]: Parsing macros/adapters/columns.sql
22:00:36.095923 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_alias.sql
22:00:36.096836 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_schema.sql
22:00:36.098214 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_database.sql
22:00:36.099081 [debug] [MainThread]: Parsing tests/generic/builtin.sql
22:00:36.216517 [debug] [MainThread]: 1603: static parser failed on agg_per_program.sql
22:00:36.224472 [debug] [MainThread]: 1602: parser fallback to jinja rendering on agg_per_program.sql
22:00:36.225268 [debug] [MainThread]: 1603: static parser failed on session.sql
22:00:36.227447 [debug] [MainThread]: 1602: parser fallback to jinja rendering on session.sql
22:00:36.228095 [debug] [MainThread]: 1603: static parser failed on agg_per_user.sql
22:00:36.230455 [debug] [MainThread]: 1602: parser fallback to jinja rendering on agg_per_user.sql
22:00:36.231184 [debug] [MainThread]: 1603: static parser failed on enriched_session.sql
22:00:36.233579 [debug] [MainThread]: 1602: parser fallback to jinja rendering on enriched_session.sql
22:00:36.297117 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt_training

22:00:36.300163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2cafe138-753e-495c-ac25-ae47e5f2d113', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f20a816a9d0>]}
22:00:36.303924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2cafe138-753e-495c-ac25-ae47e5f2d113', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f20a816af10>]}
22:00:36.304097 [info ] [MainThread]: Found 4 models, 18 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
22:00:36.305180 [info ] [MainThread]: 
22:00:36.305471 [debug] [MainThread]: Acquiring new snowflake connection "master"
22:00:36.306105 [debug] [ThreadPool]: Acquiring new snowflake connection "list_WINTERSCHOOL"
22:00:36.313823 [debug] [ThreadPool]: Using snowflake connection "list_WINTERSCHOOL"
22:00:36.313962 [debug] [ThreadPool]: On list_WINTERSCHOOL: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "audience_measurement", "target_name": "dev", "connection_name": "list_WINTERSCHOOL"} */

    show terse schemas in database WINTERSCHOOL
    limit 10000
22:00:36.314046 [debug] [ThreadPool]: Opening a new connection, currently in state init
22:00:37.985239 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.67 seconds
22:00:37.989203 [debug] [ThreadPool]: On list_WINTERSCHOOL: Close
22:00:38.213259 [debug] [ThreadPool]: Acquiring new snowflake connection "list_WINTERSCHOOL_public"
22:00:38.227344 [debug] [ThreadPool]: Using snowflake connection "list_WINTERSCHOOL_public"
22:00:38.227687 [debug] [ThreadPool]: On list_WINTERSCHOOL_public: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "audience_measurement", "target_name": "dev", "connection_name": "list_WINTERSCHOOL_public"} */

    show terse objects in WINTERSCHOOL.public
22:00:38.227894 [debug] [ThreadPool]: Opening a new connection, currently in state closed
22:00:39.012437 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.78 seconds
22:00:39.016379 [debug] [ThreadPool]: On list_WINTERSCHOOL_public: Close
22:00:39.226379 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
22:00:39.227110 [info ] [MainThread]: 
22:00:39.234380 [debug] [Thread-1  ]: Began running node model.dbt_audiance_measurment.session
22:00:39.235047 [info ] [Thread-1  ]: 1 of 4 START view model public.session.......................................... [RUN]
22:00:39.235962 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.dbt_audiance_measurment.session"
22:00:39.236272 [debug] [Thread-1  ]: Began compiling node model.dbt_audiance_measurment.session
22:00:39.236599 [debug] [Thread-1  ]: Compiling model.dbt_audiance_measurment.session
22:00:39.245482 [debug] [Thread-1  ]: Writing injected SQL for node "model.dbt_audiance_measurment.session"
22:00:39.246446 [debug] [Thread-1  ]: finished collecting timing info
22:00:39.246774 [debug] [Thread-1  ]: Began executing node model.dbt_audiance_measurment.session
22:00:39.296350 [debug] [Thread-1  ]: Writing runtime SQL for node "model.dbt_audiance_measurment.session"
22:00:39.297142 [debug] [Thread-1  ]: Using snowflake connection "model.dbt_audiance_measurment.session"
22:00:39.297264 [debug] [Thread-1  ]: On model.dbt_audiance_measurment.session: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "audience_measurement", "target_name": "dev", "node_id": "model.dbt_audiance_measurment.session"} */

  create or replace  view WINTERSCHOOL.public.session 
  
   as (
    WITH timestamp_events AS (
         SELECT
                users as users,
                channel as channel,
                time as timestamp
         FROM WINTERSCHOOL.public.timestamps
         WHERE timestamp >= '2022-02-08'
           AND timestamp < dateadd(day, 3, '2022-02-08')
     ),
    sessions AS(
	SELECT
		users,
		channel,
		timestamp as beginning,
		LEAD(timestamp) OVER (
	        	PARTITION BY users 
	        	ORDER BY timestamp
		) as finish
	FROM 
		timestamp_events
)

SELECT
    users,
    channel,
    beginning,
    COALESCE(finish, DATEADD(hour,3, beginning)) as finish
FROM
    sessions
  );
22:00:39.297345 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
22:00:40.103362 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.81 seconds
22:00:40.118161 [debug] [Thread-1  ]: finished collecting timing info
22:00:40.118493 [debug] [Thread-1  ]: On model.dbt_audiance_measurment.session: Close
22:00:40.344524 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2cafe138-753e-495c-ac25-ae47e5f2d113', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f20b067eaf0>]}
22:00:40.345466 [info ] [Thread-1  ]: 1 of 4 OK created view model public.session..................................... [[32mSUCCESS 1[0m in 1.11s]
22:00:40.346209 [debug] [Thread-1  ]: Finished running node model.dbt_audiance_measurment.session
22:00:40.347487 [debug] [Thread-1  ]: Began running node model.dbt_audiance_measurment.enriched_session
22:00:40.348486 [info ] [Thread-1  ]: 2 of 4 START view model public.enriched_session................................. [RUN]
22:00:40.349712 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.dbt_audiance_measurment.enriched_session"
22:00:40.350038 [debug] [Thread-1  ]: Began compiling node model.dbt_audiance_measurment.enriched_session
22:00:40.350329 [debug] [Thread-1  ]: Compiling model.dbt_audiance_measurment.enriched_session
22:00:40.356844 [debug] [Thread-1  ]: Writing injected SQL for node "model.dbt_audiance_measurment.enriched_session"
22:00:40.357340 [debug] [Thread-1  ]: finished collecting timing info
22:00:40.357591 [debug] [Thread-1  ]: Began executing node model.dbt_audiance_measurment.enriched_session
22:00:40.360060 [debug] [Thread-1  ]: Writing runtime SQL for node "model.dbt_audiance_measurment.enriched_session"
22:00:40.361564 [debug] [Thread-1  ]: Using snowflake connection "model.dbt_audiance_measurment.enriched_session"
22:00:40.361706 [debug] [Thread-1  ]: On model.dbt_audiance_measurment.enriched_session: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "audience_measurement", "target_name": "dev", "node_id": "model.dbt_audiance_measurment.enriched_session"} */

  create or replace  view WINTERSCHOOL.public.enriched_session 
  
   as (
    WITH enriched_sessions as (
    select session.users       as users,
           schedule.channel as channel,
           session.beginning       as session_beginning,
           schedule.beginning as schedule_beginning,
           session.finish           as session_end,
           schedule.stop      as schedule_end,
           schedule.program           as program,
           schedule.genre         as genre,
           session.channel         as common_channel
    FROM WINTERSCHOOL.public.session as session
             INNER JOIN WINTERSCHOOL.public.schedule as schedule
        ON session.channel = schedule.channel
            AND session.beginning < schedule.stop
            AND session.finish > schedule.beginning
    WHERE
        session.finish >= '2022-02-08'
      AND session.finish
        < dateadd(day, 3, '2022-02-08')
    )

SELECT users,
       common_channel,
       greatest(session_beginning, schedule_beginning) beginning,
       least(session_end, schedule_end)                finish,
       DATEDIFF(minute, beginning, finish)           time_watched_minutes,
       program,
       genre
FROM enriched_sessions
  );
22:00:40.361795 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
22:00:41.230061 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.87 seconds
22:00:41.233427 [debug] [Thread-1  ]: finished collecting timing info
22:00:41.233876 [debug] [Thread-1  ]: On model.dbt_audiance_measurment.enriched_session: Close
22:00:41.448512 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2cafe138-753e-495c-ac25-ae47e5f2d113', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f208edf2820>]}
22:00:41.449358 [info ] [Thread-1  ]: 2 of 4 OK created view model public.enriched_session............................ [[32mSUCCESS 1[0m in 1.10s]
22:00:41.450045 [debug] [Thread-1  ]: Finished running node model.dbt_audiance_measurment.enriched_session
22:00:41.451318 [debug] [Thread-1  ]: Began running node model.dbt_audiance_measurment.agg_per_program
22:00:41.451830 [info ] [Thread-1  ]: 3 of 4 START view model public.agg_per_program.................................. [RUN]
22:00:41.452834 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.dbt_audiance_measurment.agg_per_program"
22:00:41.453419 [debug] [Thread-1  ]: Began compiling node model.dbt_audiance_measurment.agg_per_program
22:00:41.453715 [debug] [Thread-1  ]: Compiling model.dbt_audiance_measurment.agg_per_program
22:00:41.460001 [debug] [Thread-1  ]: Writing injected SQL for node "model.dbt_audiance_measurment.agg_per_program"
22:00:41.460665 [debug] [Thread-1  ]: finished collecting timing info
22:00:41.461028 [debug] [Thread-1  ]: Began executing node model.dbt_audiance_measurment.agg_per_program
22:00:41.464756 [debug] [Thread-1  ]: Writing runtime SQL for node "model.dbt_audiance_measurment.agg_per_program"
22:00:41.465744 [debug] [Thread-1  ]: Using snowflake connection "model.dbt_audiance_measurment.agg_per_program"
22:00:41.465937 [debug] [Thread-1  ]: On model.dbt_audiance_measurment.agg_per_program: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "audience_measurement", "target_name": "dev", "node_id": "model.dbt_audiance_measurment.agg_per_program"} */

  create or replace  view WINTERSCHOOL.public.agg_per_program 
  
   as (
    SELECT
    program,
    '2022-02-08' as date,
    CONCAT(program, '2022-02-08') as unique_id,
    SUM (time_watched_minutes) total_time_minutes,
    COUNT ( DISTINCT users ) unique_users_watched,
    CAST(total_time_minutes AS DECIMAL) / unique_users_watched average_time_per_digibox
FROM WINTERSCHOOL.public.enriched_session
WHERE finish >= '2022-02-08'
AND finish < dateadd(day, 3, '2022-02-08')

GROUP BY program
  );
22:00:41.466096 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
22:00:42.356507 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.89 seconds
22:00:42.359734 [debug] [Thread-1  ]: finished collecting timing info
22:00:42.360128 [debug] [Thread-1  ]: On model.dbt_audiance_measurment.agg_per_program: Close
22:00:42.569011 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2cafe138-753e-495c-ac25-ae47e5f2d113', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f208edf28b0>]}
22:00:42.569800 [info ] [Thread-1  ]: 3 of 4 OK created view model public.agg_per_program............................. [[32mSUCCESS 1[0m in 1.12s]
22:00:42.570474 [debug] [Thread-1  ]: Finished running node model.dbt_audiance_measurment.agg_per_program
22:00:42.570825 [debug] [Thread-1  ]: Began running node model.dbt_audiance_measurment.agg_per_user
22:00:42.571541 [info ] [Thread-1  ]: 4 of 4 START view model public.agg_per_user..................................... [RUN]
22:00:42.572482 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.dbt_audiance_measurment.agg_per_user"
22:00:42.572800 [debug] [Thread-1  ]: Began compiling node model.dbt_audiance_measurment.agg_per_user
22:00:42.573101 [debug] [Thread-1  ]: Compiling model.dbt_audiance_measurment.agg_per_user
22:00:42.579657 [debug] [Thread-1  ]: Writing injected SQL for node "model.dbt_audiance_measurment.agg_per_user"
22:00:42.580225 [debug] [Thread-1  ]: finished collecting timing info
22:00:42.580471 [debug] [Thread-1  ]: Began executing node model.dbt_audiance_measurment.agg_per_user
22:00:42.583947 [debug] [Thread-1  ]: Writing runtime SQL for node "model.dbt_audiance_measurment.agg_per_user"
22:00:42.585170 [debug] [Thread-1  ]: Using snowflake connection "model.dbt_audiance_measurment.agg_per_user"
22:00:42.585369 [debug] [Thread-1  ]: On model.dbt_audiance_measurment.agg_per_user: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "audience_measurement", "target_name": "dev", "node_id": "model.dbt_audiance_measurment.agg_per_user"} */

  create or replace  view WINTERSCHOOL.public.agg_per_user 
  
   as (
    SELECT
    users,
    '2022-02-08' as date,
    CONCAT(users, '2022-02-08') as unique_id,
    SUM (time_watched_minutes) total_time_minutes,
    COUNT ( DISTINCT program ) different_programs_watched,
    CAST(total_time_minutes AS DECIMAL) / different_programs_watched average_time_per_program
FROM WINTERSCHOOL.public.enriched_session
WHERE finish >= '2022-02-08'
AND finish < dateadd(day, 3, '2022-02-08')
GROUP BY users
  );
22:00:42.585521 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
22:00:43.587794 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.0 seconds
22:00:43.590913 [debug] [Thread-1  ]: finished collecting timing info
22:00:43.591332 [debug] [Thread-1  ]: On model.dbt_audiance_measurment.agg_per_user: Close
22:00:43.808924 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2cafe138-753e-495c-ac25-ae47e5f2d113', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f20a81b6910>]}
22:00:43.809725 [info ] [Thread-1  ]: 4 of 4 OK created view model public.agg_per_user................................ [[32mSUCCESS 1[0m in 1.24s]
22:00:43.810400 [debug] [Thread-1  ]: Finished running node model.dbt_audiance_measurment.agg_per_user
22:00:43.812359 [debug] [MainThread]: Acquiring new snowflake connection "master"
22:00:43.813223 [info ] [MainThread]: 
22:00:43.813922 [info ] [MainThread]: Finished running 4 view models in 7.51s.
22:00:43.814450 [debug] [MainThread]: Connection 'master' was properly closed.
22:00:43.814713 [debug] [MainThread]: Connection 'model.dbt_audiance_measurment.agg_per_user' was properly closed.
22:00:43.825320 [info ] [MainThread]: 
22:00:43.825745 [info ] [MainThread]: [32mCompleted successfully[0m
22:00:43.826111 [info ] [MainThread]: 
22:00:43.826399 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
22:00:43.826793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f20aa09ae20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f20aa09ad00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f208ede5190>]}
